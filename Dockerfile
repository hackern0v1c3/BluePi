FROM python:3

ENV VERSION="0.2"

RUN apt-get update && apt-get install -y --no-install-recommends tcpdump && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/app
VOLUME [ "/usr/src/app/logs" ]
VOLUME [ "/usr/src/app/attacks" ]

COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

ARG BROADCAST_IP='224.0.0.252'
ENV BROADCAST_IP="${BROADCAST_IP}"
ARG NBNS_SLEEP=30
ENV NBNS_SLEEP="${NBNS_SLEEP}"
ARG LLMNR_SLEEP=30
ENV LLMNR_SLEEP="${LLMNR_SLEEP}"
ARG CONSOLE_LOG_LEVEL="warning"
ENV CONSOLE_LOG_LEVEL="${CONSOLE_LOG_LEVEL}"
ARG FILE_LOG_LEVEL="warning"
ENV FILE_LOG_LEVEL="${FILE_LOG_LEVEL}"
ARG FILE_LOG_RETENTION=30
ENV FILE_LOG_RETENTION="${FILE_LOG_RETENTION}"
ARG DISABLE_NBNS_SCANNING='F'
ENV DISABLE_NBNS_SCANNING="${DISABLE_NBNS_SCANNING}"
ARG DISABLE_LLMNR_SCANNING='F'
ENV DISABLE_LLMNR_SCANNING="${DISABLE_LLMNR_SCANNING}"
ARG ENABLE_EMAIL_ALERTS='T'
ENV ENABLE_EMAIL_ALERTS="${ENABLE_EMAIL_ALERTS}"
ARG ENABLE_EMAIL_STARTUP_TEST='T'
ENV ENABLE_EMAIL_STARTUP_TEST="${ENABLE_EMAIL_STARTUP_TEST}"
ARG ENABLE_EMAIL_SERVER_AUTHENTICATION='T'
ENV ENABLE_EMAIL_SERVER_AUTHENTICATION="${ENABLE_EMAIL_SERVER_AUTHENTICATION}"
ARG EMAIL_RECIPIENT=''
ENV EMAIL_RECIPIENT="${EMAIL_RECIPIENT}"
ARG EMAIL_SENDER=''
ENV EMAIL_SENDER="${EMAIL_SENDER}"
ARG EMAIL_SENDER_PASSWORD=''
ENV EMAIL_SENDER_PASSWORD="${EMAIL_SENDER_PASSWORD}"
ARG EMAIL_SERVER_ADDRESS='smtp.gmail.com'
ENV EMAIL_SERVER_ADDRESS="${EMAIL_SERVER_ADDRESS}"
ARG EMAIL_SERVER_PORT=587
ENV EMAIL_SERVER_PORT="${EMAIL_SERVER_PORT}"
ARG EMAIL_SERVER_STARTTLS='T'
ENV EMAIL_SERVER_STARTTLS="${EMAIL_SERVER_STARTTLS}"
ARG ATTACK_TIMEOUT_DURATION=3600
ENV ATTACK_TIMEOUT_DURATION="${ATTACK_TIMEOUT_DURATION}"

CMD [ "python", "./main.py" ]